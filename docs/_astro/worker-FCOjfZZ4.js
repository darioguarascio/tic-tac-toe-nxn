class d{INITIAL_MOVE_WEIGHT=3;gridSize;strikeSize;state;movesHistory;constructor(t,e){this.gridSize=t,this.strikeSize=e,this.state=new Array(t*t).fill(2),this.movesHistory=new Array}makeMove(t,e,r){if(typeof e>"u"||this.state.length<e||e<0)throw new Error("Invalid cell:"+e);if(this.state[e]!==2)throw new Error("Invalid move: "+this.state[e]);this.movesHistory.push([t,e,Array.from(this.state),r]),this.state[e]=t}movesLeft(){let t=0;for(let e=0;e<this.gridSize*this.gridSize;e++)this.state[e]===2&&t++;return t}generateRandomMoveset(){const t=new Array;for(let e=0;e<this.gridSize*this.gridSize;e++)this.state[e]===2&&t.push([e,this.INITIAL_MOVE_WEIGHT]);return t}encode(t){return`${this.strikeSize}.${(t??this.state).join("")}`}getValue(t,e){return this.state[t*this.gridSize+e]}getFlatIndex(t,e){return t*this.gridSize+e}checkSequence(t,e,r,s){let i=this.getValue(t,e);if(i===2)return null;let u=[this.getFlatIndex(t,e)];for(let n=1;n<this.strikeSize;n++){let o=t+n*r,c=e+n*s;if(this.getValue(o,c)!==i)return null;u.push(this.getFlatIndex(o,c))}return u}findKConsecutive(){const t=this.gridSize,e=this.strikeSize;for(let r=0;r<t;r++)for(let s=0;s<=t-e;s++){let i=this.checkSequence(r,s,0,1);if(i)return i}for(let r=0;r<=t-e;r++)for(let s=0;s<t;s++){let i=this.checkSequence(r,s,1,0);if(i)return i}for(let r=0;r<=t-e;r++)for(let s=0;s<=t-e;s++){let i=this.checkSequence(r,s,1,1);if(i)return i}for(let r=0;r<=t-e;r++)for(let s=e-1;s<t;s++){let i=this.checkSequence(r,s,1,-1);if(i)return i}return null}getState(){return{state:this.state}}end(t){let e=this.movesHistory,r=[];for(let s of e)if(s[0]==1){for(let i in s[3])s[3][i][0]===s[1]&&(s[3][i][1]+=t);r.push({state:this.encode(s[2]),moves:s[3]})}return r}}let a;const l={player:0,machine:0,draws:0},h={};self.onmessage=f=>{switch(f.data[0]){case"GET_TRAIN_DATA":return self.postMessage(["TRAIN_DATA",h]);case"NEW_GAME":const t=parseInt(f.data[1]),e=parseInt(f.data[2]);return a=new d(t,e),self.postMessage(["NEW_GAME",a.getState()]);case"MOVE":const r=parseInt(f.data[1]);try{a.makeMove(0,r,null)}catch(n){return self.postMessage(["ERR",n])}let s=a.findKConsecutive();if(s)return a.end(-2).forEach(({state:n,moves:o})=>h[n]=o),l.player++,self.postMessage(["END",{...a.getState(),strike:s,winner:"player",stats:l}]);if(a.movesLeft()===0)return a.end(1).forEach(({state:n,moves:o})=>h[n]=o),l.draws++,self.postMessage(["END",{...a.getState(),strike:null,winner:"draw",stats:l}]);let i=h[a.encode(a.state)];i||(i=a.generateRandomMoveset());const u=i.sort((n,o)=>o[1]-n[1]).map(n=>n[0]).shift();try{a.makeMove(1,u,i)}catch(n){return self.postMessage(["ERR",n])}return s=a.findKConsecutive(),s?(a.end(3).forEach(({state:n,moves:o})=>h[n]=o),l.machine++,self.postMessage(["END",{...a.getState(),strike:s,winner:"machine",stats:l}])):a.movesLeft()===0?(a.end(1).forEach(({state:n,moves:o})=>h[n]=o),l.draws++,self.postMessage(["END",{...a.getState(),strike:null,winner:"draw",stats:l}])):self.postMessage(["STATE",{...a.getState(),moves:i,move:u}])}};
//# sourceMappingURL=worker-FCOjfZZ4.js.map
